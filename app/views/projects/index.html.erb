<p id="notice"><%= notice %></p>

<h1>Projects</h1>

<br /><br />

<input type="button" value="Edit in Batch Mode" onclick="startEdit()" />
<input type="button" value="Save All Rows" onclick="saveRows()" />

<br /><br />

<table id="jqGrid"></table>
<div id="jqGridPager"></div>

<script type="text/javascript">

  $(document).ready(function () {
    $("#jqGrid").jqGrid({
      url: "/projects",
      editurl: ' /projects/update',
      datatype: "json",
      colModel: [
        {
          label: "ID#",
          name: "id",
          width: 10
        },
        {
          label: "Name",
          name: 'name',
          width: 100,
          editable: true // must set editable to true if you want to make the field editable
        },
        {
          label: "Status",
          name: 'status',
          width: 30,
          editable: true
        },
        {
          label : "Cap_able",
          name: 'is_capitalizable',
          width: 30,
          editable: true
        },
        {
          label : "Weight",
          name: 'weight',
          width: 20,
          editable: true
        },
        {
          label : "Release date",
          name: 'release_date',
          width: 20,
          editable: true
        },{
          label : "Description",
          name: 'description',
          width: 200,
          editable: true
        }
      ],
      sortname: 'ID#',
      loadonce : true,
      viewrecords: true,
      onSelectRow: editRow, // the javascript function to call on row click. will ues to to put the row in edit mode
      width: 780,
      height: 200,
      rowNum: 10,
      pager: "#jqGridPager",
      gridview: true
    });


    var lastSelection;

    function editRow(id) {
      if (id && id !== lastSelection) {
        var grid = $("#jqGrid");
        grid.jqGrid('restoreRow', lastSelection);
        grid.jqGrid('editRow',id, {keys: true} );
        lastSelection = id;
      }
    }
  });


  function startEdit() {
    var grid = $("#jqGrid");
    var ids = grid.jqGrid('getDataIDs');

    for (var i = 0; i < ids.length; i++) {
      grid.jqGrid('editRow',ids[i]);
    }
  };
  function saveRows() {
    var grid = $("#jqGrid");
    var ids = grid.jqGrid('getDataIDs');

    for (var i = 0; i < ids.length; i++) {
      grid.jqGrid('saveRow', ids[i]);
    }
  }

</script>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Status</th>
      <th>Is capitalizable</th>
      <th>Weight</th>
      <th>Release date</th>
      <th>Description</th>
      <th>Team</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @projects.each do |project| %>
      <tr>
        <td><%= project.name %></td>
        <td><%= project.status %></td>
        <td><%= project.is_capitalizable %></td>
        <td><%= project.weight %></td>
        <td><%= project.release_date %></td>
        <td><%= project.description %></td>
        <td><%= project.team_id %></td>
        <td><%= link_to 'Show', project %></td>
        <td><%= link_to 'Edit', edit_project_path(project) %></td>
        <td><%= link_to 'Destroy', project, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Project', new_project_path %>
