<p id="notice"><%= notice %></p>

<h1>Cap_Hour_calculation</h1>

<br /><br />

<input type="button" value="Edit in Batch Mode" onclick="startEdit()" />
<input type="button" value="Save All Rows" onclick="saveRows()" />

<br /><br />

<table id="jqGrid"></table>
<div id="jqGridPager"></div>

<script type="text/javascript">

  $(document).ready(function () {
    $("#jqGrid").jqGrid({
      url: "/cap_hour_calculation.json",
      datatype: "json",
      colModel: [
        {
          label: "Employee Name",
          name: "employee_name",
          width: 120
        },{
          label: "Team",
          name: "team_name",
          width: 160
        },{
          label: "Project",
          name: "project_name",
          width: 260
        },{
          label: "Employee Type",
          name: "employee_employment_type",
          width: 75
        },{
          label: "Hourly Rate",
          name: "employee_hourly_rate",
          width: 75
        },{
          label: "Capitalizable Rate",
          name: "capitalizable_group_description",
          width: 75
        },{
          label: "Team Dedication Weight",
          name: "dedication_weight",
          width: 75
        },{
          label: "Capitalizable Day",
          name: "result",
          width: 75
        }
      ],
      sortname: 'Employee Name',
      loadonce : true,
      viewrecords: true,
      onSelectRow: startEdit, // the javascript function to call on row click. will ues to to put the row in edit mode
      //width: 100,
      height: 200,
      rowNum: 10,
      pager: "#jqGridPager",
      gridview: true
    });

    // We need to have a navigation bar in order to add custom buttons to it
    $('#jqGrid').navGrid('#jqGridPager',
        { edit: false, add: false, del: false, search: true, refresh: true, view: false, position: "left", cloneToTop: true });

    // add first custom button
    $('#jqGrid').navButtonAdd('#jqGridPager',
        {
          buttonicon: "ui-icon-calculator",
          title: "Column chooser",
          caption: "Columns",
          position: "last",
          onClickButton: function() {
            // call the column chooser method
            jQuery("#jqGrid").jqGrid('columnChooser');
          }
        });



    var lastSelection;

    function editRow(id) {
      if (id && id !== lastSelection) {
        var grid = $("#jqGrid");
        grid.jqGrid('restoreRow', lastSelection);
        grid.jqGrid('editRow',id, {keys: true} );
        lastSelection = id;
      }
    }
  });


  function startEdit() {
    var grid = $("#jqGrid");
    var ids = grid.jqGrid('getDataIDs');

    for (var i = 0; i < ids.length; i++) {
      grid.jqGrid('editRow',ids[i]);
    }
  };
  function saveRows() {
    var grid = $("#jqGrid");
    var ids = grid.jqGrid('getDataIDs');

    for (var i = 0; i < ids.length; i++) {
      grid.jqGrid('saveRow', ids[i]);
    }
  }

</script>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Team</th>
      <th>Project Name</th>
      <th>Employment type</th>
      <th>Hourly rate</th>
      <th>Location</th>
      <th>Capitalizable group</th>
      <th>Commencement date</th>
      <th>Termination date</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @employees.each do |employee| %>
      <% employee.team_members.each do |team_member| %>
          <% team_member.team.projects.each do |project| %>
              <% result = calculate_capitalized_hour @iteration.find(7).work_day, employee.capitalizable_group.capitalizable_rate, 100, team_member.dedication_weight, project.weight %>
            <tr>
              <td><%= employee.name %></td>
              <td><%= project.team.name %></td>
              <td><%= project.name %></td>
              <td><%= employee.employment_type %></td>
              <td><%= employee.hourly_rate %></td>
              <td><%= employee.location %></td>
              <td><%= employee.capitalizable_group.description %></td>
              <td><%= team_member.dedication_weight %></td>
              <td><%= result.to_f %></td>
              <td><%= link_to 'Show', employee %></td>
              <td><%= link_to 'Edit', edit_employee_path(employee) %></td>
              <td><%= link_to 'Destroy', employee, method: :delete, data: { confirm: 'Are you sure?' } %></td>
            </tr>
          <% end %>
      <% end %>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Employee', new_employee_path %>
